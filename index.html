<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Obra - Mapa Maric√°</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2196F3">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Controle de Obra">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNCIgZmlsbD0iIzIxOTZGMyIvPgo8cGF0aCBkPSJNMTYgOEMxMi42ODYzIDggMTAgMTAuNjg2MyAxMCAxNEMxMCAxNy4zMTM3IDEyLjY4NjMgMjAgMTYgMjBDMTkuMzEzNyAyMCAyMiAxNy4zMTM3IDIyIDE0QzIyIDEwLjY4NjMgMTkuMzEzNyA4IDE2IDhaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="map"></div>
    
    <!-- Control Panel -->
    <div class="container">
        <!-- Header com status de sincroniza√ß√£o -->
        <div class="header">
            <h1>üèóÔ∏è Controle de Obra - Maric√°</h1>
            <div class="header-controls">
                <div id="sync-status" class="sync-status" title="Status de sincroniza√ß√£o">
                    <div class="sync-dot"></div>
                    <span class="sync-text">Sincronizado</span>
                </div>
                <button id="menu-toggle" class="menu-toggle" aria-label="Abrir menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
        
        <!-- Overlay para fechar menu em mobile -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>
        
        <!-- Painel lateral -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>üèóÔ∏è Controle de Obra</h2>
                <p>Maric√° - RJ</p>
                <button class="sidebar-close" id="sidebar-close" aria-label="Fechar menu">√ó</button>
            </div>
            
            <div class="control-group">
            <button id="satellite-toggle" class="control-btn">
                <span class="icon">üõ∞Ô∏è</span>
                Sat√©lite
            </button>
            
            <button id="export-kmz" class="control-btn">
                <span class="icon">üìÅ</span>
                Exportar KMZ
            </button>
            
            <button id="export-excel" class="control-btn">
                <span class="icon">üìä</span>
                Exportar Excel
            </button>
            
            <label for="import-kmz" class="control-btn">
                <span class="icon">üìÇ</span>
                Importar KMZ
                <input type="file" id="import-kmz" accept=".kmz,.kml" multiple style="display: none;">
            </label>
            
            <button id="manage-works" class="control-btn" title="Gerenciar obras">
                <span class="icon">üìä</span>
                Gerenciar Obras
            </button>
            
            <button id="sync-offline" class="control-btn sync-btn" style="display: none;">
                <span class="icon">üîÑ</span>
                Sincronizar
            </button>
            
            <button id="clear-data" class="control-btn danger-btn">
                <span class="icon">üóëÔ∏è</span>
                Limpar Dados
            </button>
            
            <button id="location-toggle" class="control-btn" title="Ativar rastreamento de localiza√ß√£o">
                üìç Minha Localiza√ß√£o
            </button>
            
            <button id="devices-toggle" class="control-btn" title="Mostrar localiza√ß√µes dos dispositivos">
                üì± Dispositivos Online
            </button>
            
            <!-- Bot√µes de sincroniza√ß√£o espec√≠ficos por modo -->
            <button id="manual-sync-pc" class="control-btn sync-btn" title="Sincronizar manualmente (modo PC)">
                üîÑ Sincronizar Agora
            </button>
            
            <button id="download-offline-pwa" class="control-btn offline-btn" style="display: none;" title="Baixar dados para trabalho offline">
                üì• Baixar Dados
            </button>
            
            <button id="upload-offline-pwa" class="control-btn offline-btn" style="display: none;" title="Enviar dados quando online">
                üì§ Enviar Dados
            </button>
            </div>
        </div>
    </div>
    
    <!-- Loading Indicator -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Carregando mapa...</p>
    </div>
    
    <!-- Status de Sincroniza√ß√£o -->
    <div id="sync-status" class="sync-status" style="display: none;">
        <span id="sync-status-text">Sincronizando...</span>
    </div>
    
    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <!-- JSZip para manipula√ß√£o de arquivos ZIP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    
    <!-- SheetJS para exporta√ß√£o Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    
    <script src="app.js"></script>

</div>

    <!-- Modal de Gerenciamento de Obras -->
    <div id="works-modal" class="modal">
        <div class="modal-content works-modal-content">
            <div class="modal-header">
                <h3>üìä Gerenciamento de Obras</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="works-summary">
                    <div class="summary-card">
                        <h4>üìà Resumo</h4>
                        <p><strong>Total de Obras:</strong> <span id="total-works">0</span></p>
                        <p><strong>Total de Marca√ß√µes:</strong> <span id="total-markings">0</span></p>
                    </div>
                </div>
                
                <div class="works-filters">
                    <input type="text" id="search-works" placeholder="üîç Buscar por n√∫mero da O.S..." class="search-input">
                    <button id="refresh-works" class="filter-btn">üîÑ Atualizar</button>
                </div>
                
                <div class="works-table-container">
                    <table id="works-table" class="works-table">
                        <thead>
                            <tr>
                                <th>N√∫mero da O.S.</th>
                                <th>Produto</th>
                                <th>Marca√ß√µes</th>
                                <th>√öltima Atualiza√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="works-table-body">
                            <!-- Dados ser√£o inseridos dinamicamente -->
                        </tbody>
                    </table>
                </div>
                
                <div class="imported-markings-section">
                    <h4>üìÅ Marca√ß√µes Importadas (KMZ)</h4>
                    <div class="imported-summary">
                        <p><strong>Total de Arquivos Importados:</strong> <span id="total-imported-files">0</span></p>
                        <p><strong>Total de Marca√ß√µes Importadas:</strong> <span id="total-imported-markings">0</span></p>
                    </div>
                    
                    <div class="imported-table-container">
                        <table id="imported-table" class="works-table">
                            <thead>
                                <tr>
                                    <th>Nome do Arquivo</th>
                                    <th>Marca√ß√µes</th>
                                    <th>Data de Importa√ß√£o</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="imported-table-body">
                                <!-- Dados ser√£o inseridos dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="works-actions">
                    <button id="export-all-works" class="action-btn primary">
                        üì¶ Exportar Todas as Obras
                    </button>
                    <button id="clear-all-works" class="action-btn danger">
                        üóëÔ∏è Limpar Todas as Obras
                    </button>
                    <button id="clear-imported-markings" class="action-btn danger">
                        üóëÔ∏è Limpar Todas as Importa√ß√µes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para informa√ß√µes da marca√ß√£o -->
    <div id="marking-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Informa√ß√µes da Marca√ß√£o</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="marking-form">
                    <div class="form-group">
                        <label for="os-number">N√∫mero da O.S:</label>
                        <input type="text" id="os-number" name="osNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="product">Produto:</label>
                        <input type="text" id="product" name="product" required>
                    </div>
                    <div class="form-group">
                        <label for="measurement">Metragem:</label>
                        <input type="number" id="measurement" name="measurement" step="0.01" required>
                        <select id="measurement-unit" name="measurementUnit">
                            <option value="m">metros (m)</option>
                            <option value="m¬≤">metros¬≤ (m¬≤)</option>
                            <option value="km">quil√¥metros (km)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="description">Descri√ß√£o:</label>
                        <textarea id="description" name="description" rows="3" placeholder="Descri√ß√£o detalhada da marca√ß√£o..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" id="cancel-marking" class="btn-secondary">Cancelar</button>
                        <button type="submit" class="btn-primary">Salvar Marca√ß√£o</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
</html>